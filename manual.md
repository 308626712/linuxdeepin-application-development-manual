Linux Deepin 应用程序开发手册
==========================

> 王勇 于 2013年夏

* * *

*    [前言](#prelude)
    *    [致战斗在一线的 Linux Deepin 勇士们, 为理想而战！](#for-dream)
    *    [为什么我要写这本书？](#why-i-write-this-book)
    *    [本书面向的读者人群](#reader-need-to-know)
    *    [Linux需要什么样的应用程序？](#what-kind-of-application-is-we-need)
    *    [开发者应该怀着怎样的理念去开发用户喜欢的产品？](#development-concept)
    *    [我们需要怎样的应用开发社区氛围？](#how-to-build-development-community)
  
*    [编码之前的思考](#think-before-coding)
    *    [怎样一步一步构建Linux应用程序？](#build-application-step-by-step)
    *    [开发应用程序都需要掌握哪些基本技术？](#what-technology-we-need)
    *    [构建应用程序的基本技术](#basic-technology)
    *    [构建应用程序的高级技术](#advanced-technology)
    *    [写补丁的规则](#how-to-write-patch)
    *    [编写代码的准则](#the-rule-of-coding)
    *    [为什么选择 PyGTK+ 作为应用程序开发基础？](#why-choose-pygtk)
    *    [关于 Python/PyGTK+ 的错误认识](#misconceptions-about-python/pygtk)
    *    [Python代码编写规范](#python-coding-specification)
  
*    [Deepin-UI](#deepin-ui)
    *    [Deepin-UI 诞生的故事](#how-deepin-ui-born)
    *    [为什么需要 Deepin-UI?](#why-we-need-deepin-ui)
    *    [Deepin-UI 原理](#principle-of-deepin-ui)
    *    [Deepin-UI hello world!](#deepin-ui-hello-world)
    *    [Deepin-UI 简单控件使用](#usage-of-simple-widget)
    *    [Deepin-UI 高级控件使用](#usage-of-advanced-widget)
    *    [Deepin-UI 应用开发实例](#application-development-example)
	
*    [应用开发基础技术](#application-development-technology)
    *    [GTK+陷阱与技巧](#gtk-trick)
    *    [编写 Python C 扩展](#build-c-extension)
    *    [更多技术...](#more-technology)
	
*    [编写控件的艺术](#the-art-of-building-widget)
    *    [控件的重要性!](#the-importance-of-widget)
    *    [控件编写的基本原理](#the-principle-of-building-widget)
    *    [控件的构思到实现](#from-conception-to-realization)
    *    [控件编写实例](#widget-building-example)
	
* * *

<h2 id="prelude">前言</h2>

<h3 id="for-dream">致战斗在一线的 Linux Deepin 勇士们, 为理想而战！</h3>
> 在我写这本书的时候， 在中国武汉有这么一群斗士们， 他们在为中国Linux操作系统这个梦想默默的战斗着:   

>> 他们回家敲代码到半夜早已是家常便饭，他们每天都面临巨大的压力和工作量， 他们每天都面对新功能和无数Bug奋斗到深夜。  
>> 他们每天都游离于各种系统底层问题， 编译的刷屏陪他们经历了无数个日夜， 只为用户能稳定的运行系统。   
>> 他们面对操作系统级别的复杂设计时， 面对设计上各种苛刻限制， 他们永远展现的是自信和微笑。  
>> 他们细心的聆听用户的意见， 即使是最细小的用户需求都不放过。  

> 每当用户沉浸在正式版发布以后的欢喜中时， 他们早已背好行囊继续前行， 因为他们知道即使非常努力， 相对于完美仍然不够 ...  
> 在这么一个浮躁和功利的现实社会， 面对无数的误解和嘲笑时， 他们没有时间停下来打口水仗， 因为他们知道完美的产品才是最好的回击！  

> 如果有一天我们都年近古稀， 回忆起现在年轻的时候， 我们能无怨无悔的说：  
>> 我们没有浪费时间在抱怨和无奈中  
>> 我们把自己最好的青春奉献给自己最热爱的梦想  
>> 我们在尘归尘、土归土的时候还能给这个世界留下了贡献和回忆   

> 致现在仍然奋斗在一线的深度兄弟姐妹们， 为梦想加油！  

<h3 id="why-i-write-this-book">为什么我要写这本书?</h3>
> Linux 从1991年诞生到现在的20多年已经深入了我们生活的方方面面，  
从个人电脑到超级计算机， 从电视机顶盒到我们天天把玩的手机、平板，  
甚至在各种毫不起眼的地方（地铁， 公交车站， 售货机， 电子广告牌等）都在运行着Linux。  

> 全世界的黑客每天都在通过自己过人的天赋和勤奋向世界证明:  
>> 即使我们分散在世界各地， 即使我们互不认识，我们依然能通过无私和正能量建造世界上最伟大的操作系统！  

> Linux 从出生就烙下深深的技术烙印， Linux 从内核、驱动、底层基础库到各种变态工具中无不展现出超强的技术实力  
这也是Linux社区深深自豪的地方， Linux天生高效灵活的技术特质很容易就能夺取服务器、嵌入式、超算这些依赖后台技术的市场  

> 除了 Android 系统外， Linux在桌面这种直接面向用户体验的市场时却节节败退 （市场份额最有话语权）， 究其原因：  
>> Linux社区缺少技术牛人？  
>> Linux社区的合作开发有问题？  
>> Linux社区缺少能美化界面的设计师？  

> 我觉的都不是， Linux之所以在桌面上奋斗了十年不能竞争过 Microsoft 和 Apple 的最大原因是：  
>> 我们没有真的为**普通用户的需求**而思考  
>> 我们没有为了**完美的用户体验**而努力!  

> 我们总是以技术牛人自居， 我们总是狂妄地以自己的标准来代表用户，  
我们真的从世界上那些 99% 技术不如我们的人的角度去思考过问题吗？  
技术应该给世界大多数人带来更多简单的生活， 而不是只是为了做有最多牛X技术堆砌而体验极差的产品，  
Mac 早就明白 ”少即是多的设计能赢得大多数用户“ 的道理  

> 我们总是鄙视那些做UI的， 认为他们不过是换皮肤而已， 但是我们是否可知道：  
>> 一个丑陋没有经过任何排版设计的界面简直就是对用户的煎熬  
>> 一个交互体验细节极差的产品即使技术再牛X， 该难用还是难用！  

> 我们应该为了完美的用户体验不放过任何一个细节， 不放过哪怕一个像素的误差， 要做就做最好的!  
> Linux 之所有输了桌面之战， 不是因为我们没有努力，  
而是大多数高手以为我们在正确的路上战斗， 我们输在正确认识用户交互体验的理念上了。  

> 这本书的目的不光是讲解怎样从技术上实现应用程序，  
更希望能在Linux社区建立做产品的正确理念， 激励更多的开发者加入制造Linux高质量应用的行动中去。  

<h3 id="reader-need-to-know">本书面向的读者人群</h3>
> 这本书不是一本讲解怎样进行初步编程的入门书籍，  
本书主要是给有图形编程经验的编程人员提供全方位的方法来构建高质量的应用程序， 所以需要读者至少熟练下面的基本技术：
>> C语言编程  
>> Python语言编程  
>> GTK+编程经验  

> 读者朋友们可以通过系统学习以下书籍来掌握这些基本技术：
>> 《C程序设计语言》 (The C programming language)  
>> 《Python核心编程第二版》 (Core Python programming)  
>> 《GTK+开发基础》(Foundations of GTK+ development)  

<h3 id="what-kind-of-application-is-we-need">Linux需要怎么样的应用程序？</h3>
> 传统的Linux应用程序一般都是由开源技术爱好者主导， 他们一般都是在校大学生或者专业的工程师在业余时间完成的，  
> 这些人都是非常富有创造力的工程师， 他们通过自己的热情做出了很多技术上非常牛X的产品出来，  
> 在Linux刚开始发展的时候， 这些应用程序对Linux的发展起到了巨大的推动作用。  

> 但是， 大多数开源程序都会面临下面的几个问题：  
>> * 很多项目只是作者的爱好或者学习的项目， 一般做到 demo 级别就不再进步  
>> * 原作者毕业以后， 没有时间再维护项目继续向前发展， 很多很有潜力项目因为原作者的离去而衰落  
>> * 很多开源应用软件都只是无限制的堆砌功能， 项目的目标是我要有所有功能， 而不是选择性放弃， 到最后越来越臃肿  
>> * 很多开源项目并没有专门的设计师来来优化软件的UE， 让复杂的功能在合理的位置展示以简化交互流程  
>> * 很多开源项目并没有专门的设计师做整体的UI控件、布局和用色进行优化， 做出的产品从UI上说只能是中规中矩  

> Linux发展到今天， 用户对一个好的应用要求非常高， 那么Linux需要做到什么样的应用才能吸引用户：  
>> * 我们应该做一个完全功能的软件能满足用户的需求， 而不是一个又一个半成品， 太多的半成品在深深伤害着用户对Linux的信心  
>> * 一个完美的应用要做到恰到好处， 标准就是： 没有任何功能可以去掉了， 而不是还可以添加更多的功能   
>> * 我们应该为普通小白用户做产品， 而不是为Linux专家做产品，  
只有没有太多计算基础的用户能理解才能带来更多的用户， 而不是技术牛人的小众玩物  
>> * 一个完美的应用应该具有最简单的交互流程， 我们要经常问自己，  
流程能不能再简单一点， 能不能做到不用任何学习就能理解，  
而不是无穷的菜单和对话框， 经常看到很多Linux应用程序不知道怎么在合适的地方设计功能时，  
只是简单的把功能放到工具栏和菜单栏， 或者一层又一层的对话框， 菜单和对话框都是转移用户焦点的设计，  
太多只会导致用户的交互流程不能顺畅的运行， 最终也会增加应用整体使用的复杂性。  
>> * Linux应用应该具有并超越 Windows 和 Mac 的美观度才能彻底吸引普通用户，  
UI的美观和细致永远都是高质量应用应该具备的基本条件。  

<h3 id="development-concept">开发者应该怀着怎样的理念去开发用户喜欢的产品？</h3>
> Linux社区的一大特色就作者不但是构建者， 同时也是最终用户，  
在很多专业领域， 特别是编程领域， 这样的产品开发思维能开发出非常伟大的产品， 比如 emacs/vi, blender, gimp 等。

> Linux社区从来不缺乏专业性的好用工具， 但是在缺乏太多太多对普通用户足够易用的应用，  
> 究其原因还是Linux社区内缺乏足够有能力为普通用户开发产品的应用开发者。  

> 那么应用程序开发者应该怀着怎样的理念去开发用户喜欢的产品呢？
>> 1. 开发者本人应该是一个非常热爱生活的人， 善于和普通人沟通的人，  
只有我们真正去深入了解用户的需求后才能做出好用的产品。   

>> 2. 开发者要认同， 一个易用的产品不但需要有强大技术基础，  
还要有优秀的设计和体验细节， 光是技术做出的产品都太逻辑化了， 没有感染用户的生命力。  

>> 3. 开发者要时刻提醒自己： 到底谁才是我们的目标用户？  
做到这一点很难， 很多开发者都是以自我来代表用户的需求了  

>> 4. 开发者要有底线： 不是每一个用户的需求都要添加的，  
只添加目标用户需要的功能， 无限制的加功能只会导致程序越改越复杂  

>> 5. 开发者要有一颗坚强的心和抗吐槽的能力，  
用户批评你那是喜欢你的程序， 如果你开发的应用他用都不想用， 他更加懒得吐槽你  

<h3 id="how-to-build-development-community">我们需要怎样的应用开发社区氛围？</h3>
> Linux和任何其他软件开发模式最大的不同就是它的开放性， 开发者之间可以非常方便的进行技术交流，  
开发者和用户之间通过社区会有大量的交流， 让用户在产品初期就可以介入讨论。  
这种开放式的开发模式， 不但能极大提高开发者效率， 也能通过和用户之间的交流进行快速的产品缺陷更正。  

> 一个良好的开发社区氛围能极大的促进产品的发展， 而建立一个良好的开发社区氛围关键点在于：
>> * 开放
>> * 包容
>> * 实干

> 那么一个良好的开发社区应该具有具体怎么做才能形成正能量呢？
>> 1. 开发者和用户要有良好的沟通， 开发者在保证功能稳定的前提下应提前发布一些预览版让用户尝鲜，  
很多设计之初没有考虑到的问题在这个阶段能够充分的暴露出来， 以供后续版本改进。  

>> 2. 开发者之间要相互合作， 互相学习对方的优势技术做出自己产品的特色来，  
千万不要想很多Linux开源社区， 都认为自己是最好的， 其他的都是垃圾，  
这个世界上没有最好的产品， 只有最适合用户的产品。  

>> 3. 用户要对开发者要有足够的耐心， 不要一味的吐槽狂喷，  
开源软件一般都是免费使用的， 一个软件投入了作者巨大的艰辛和努力，  
作者本身图的就是在学到知识的情况下能让更多的人生活更简单就足够了，  
这时候我们作为用户应该对开发者有更多的包容心， 即使他们当前做的不好，  
只要他们充满一腔热情在开发， 我们就应该多多鼓励他们， 而不是各种神吐槽，   
Fcitx原作者放弃开发这种悲剧不要再重演。  

>> 4. 开发者也要从用户的角度考虑问题， 不要什么都是技术至上,  
很多Linux开发者有一股非常强势的技术优先思路， 超强的技术是基础， 但不是全部  
做应用软件能否做的好用的最关键点在于开发者是否能够深入到用户的需求中，完善每一个交互细节。   
简单易用的用户体验不一定需要软件的核心原创性多强， 即使原理和其他同类软件都是一样的  
但是你的产品中的每一个细节（UI细致， 控件细节， 交互细节等）都做的很好， 最终照样可以做出完美体验的产品。  
中国大陆的 QQ 聊天工具就是一个最好的例子， 他的原理并不是什么颠覆性的， 但是他的每一个细节都是精雕细作打磨而来的。  

>> 5. Talk is cheap, show me the product!  
如果 Linus 的 "Talk is cheap, show me the code!" 强调内核开发社区的理念  
"Talk is cheap, show me the product!" 就应该是应用产品的开发氛围  
Linux各大社区都充满了太多太多的讨论， 讨论越多越好， 但是太多的讨论仅仅只是吐槽， 而没有实际动作  
Linux桌面以及应用要快速的成长需要的是有一批实干精神的开发者和爱好者实际行动起来解决各种问题  
如果你知道问题在什么地方而且有能力解决， 马上去做， 而不只是动一下嘴皮子!  

<h2 id="deepin-ui">Deepin-UI</h2>

<h3 id="how-deepin-ui-born">Deepin-UI诞生的故事</h3>

